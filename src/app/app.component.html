<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control de Pagos - Autenticaci√≥n</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* AUTH STYLES */
    .auth-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 90vh;
    }

    .auth-card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      width: 100%;
      max-width: 450px;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .auth-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .auth-logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      color: white;
      font-size: 36px;
      font-weight: bold;
    }

    .auth-title {
      font-size: 28px;
      color: #333;
      margin-bottom: 10px;
    }

    .auth-subtitle {
      color: #666;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s;
    }

    .form-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-input.error {
      border-color: #f44336;
    }

    .form-input.success {
      border-color: #4caf50;
    }

    .password-strength {
      margin-top: 5px;
      font-size: 12px;
      height: 20px;
    }

    .password-strength.weak {
      color: #f44336;
    }

    .password-strength.medium {
      color: #ff9800;
    }

    .password-strength.strong {
      color: #4caf50;
    }

    .btn-auth {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
      margin-top: 10px;
    }

    .btn-auth:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .auth-switch {
      text-align: center;
      margin-top: 20px;
      color: #666;
      font-size: 14px;
    }

    .auth-link {
      color: #667eea;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
    }

    .auth-link:hover {
      text-decoration: underline;
    }

    .error-message, .success-message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .error-message {
      background: #fee;
      color: #c33;
      border-left: 4px solid #c33;
    }

    .success-message {
      background: #e8f5e9;
      color: #2e7d32;
      border-left: 4px solid #4caf50;
    }

    .error-message.show, .success-message.show {
      display: block;
    }

    /* DASHBOARD STYLES */
    .hidden {
      display: none !important;
    }

    .header-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-content {
      flex: 1;
    }

    .title {
      font-size: 36px;
      color: #333;
      margin-bottom: 5px;
    }

    .subtitle {
      color: #666;
      font-size: 16px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 20px;
    }

    .user-details {
      text-align: right;
    }

    .user-name {
      font-weight: 600;
      color: #333;
      font-size: 16px;
    }

    .btn-logout {
      padding: 8px 16px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 5px;
      transition: background 0.3s;
    }

    .btn-logout:hover {
      background: #d32f2f;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-blue { border-left: 4px solid #2196F3; }
    .stat-purple { border-left: 4px solid #9C27B0; }
    .stat-green { border-left: 4px solid #4CAF50; }
    .stat-yellow { border-left: 4px solid #FF9800; }

    .stat-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stat-label {
      color: #666;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: bold;
      color: #333;
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      opacity: 0.2;
    }

    .filters-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
    }

    .filters-content {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .search-box, .filter-box {
      flex: 1;
      min-width: 250px;
      position: relative;
    }

    .search-icon, .filter-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      color: #999;
    }

    .search-input, .filter-select {
      width: 100%;
      padding: 12px 12px 12px 40px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s;
    }

    .search-input:focus, .filter-select:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn-primary {
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.2s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
    }

    .btn-icon {
      width: 20px;
      height: 20px;
    }

    .table-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      overflow-x: auto;
    }

    .payments-table {
      width: 100%;
      border-collapse: collapse;
    }

    .payments-table thead {
      background: #f5f5f5;
    }

    .payments-table th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }

    .payments-table td {
      padding: 15px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
    }

    .table-row:hover {
      background: #f9f9f9;
    }

    .td-name {
      font-weight: 600;
      color: #333;
    }

    .td-amount {
      font-weight: 600;
      color: #2196F3;
    }

    .badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
    }

    .badge-category {
      background: #E3F2FD;
      color: #1976D2;
    }

    .badge-pagado {
      background: #E8F5E9;
      color: #388E3C;
    }

    .badge-pendiente {
      background: #FFF3E0;
      color: #F57C00;
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .btn-edit, .btn-delete {
      padding: 8px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-edit {
      background: #E3F2FD;
      color: #1976D2;
    }

    .btn-edit:hover {
      background: #1976D2;
      color: white;
    }

    .btn-delete {
      background: #FFEBEE;
      color: #D32F2F;
    }

    .btn-delete:hover {
      background: #D32F2F;
      color: white;
    }

    .action-icon {
      width: 18px;
      height: 18px;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-title {
      font-size: 24px;
      color: #333;
      margin-bottom: 25px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }

    .btn-submit {
      flex: 1;
      padding: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    .btn-cancel {
      flex: 1;
      padding: 12px;
      background: #f5f5f5;
      color: #333;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    .empty-row {
      text-align: center;
      padding: 40px !important;
      color: #999;
    }

    @media (max-width: 768px) {
      .filters-content {
        flex-direction: column;
      }
      
      .search-box, .filter-box {
        width: 100%;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .header-card {
        flex-direction: column;
        text-align: center;
        gap: 20px;
      }

      .user-details {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- AUTH SECTION -->
  <div id="authSection" class="auth-container">
    <div class="auth-card">
      <div class="auth-header">
        <div class="auth-logo">üí≥</div>
        <h1 class="auth-title" id="authTitle">Iniciar Sesi√≥n</h1>
        <p class="auth-subtitle">Control de Pagos - Sistema de Gesti√≥n</p>
      </div>

      <div class="error-message" id="errorMessage"></div>
      <div class="success-message" id="successMessage"></div>

      <!-- Login Form -->
      <form id="loginForm">
        <div class="form-group">
          <label class="form-label">Correo Electr√≥nico</label>
          <input type="email" id="loginEmail" class="form-input" placeholder="tu@email.com" required>
        </div>
        <div class="form-group">
          <label class="form-label">Contrase√±a</label>
          <input type="password" id="loginPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>
        <button type="submit" class="btn-auth">Iniciar Sesi√≥n</button>
        <div style="text-align: center; margin-top: 15px;">
          <a class="auth-link" onclick="showForgotPassword()" style="font-size: 13px;">¬øOlvidaste tu contrase√±a?</a>
        </div>
      </form>

      <!-- Register Form -->
      <form id="registerForm" class="hidden">
        <div class="form-group">
          <label class="form-label">Nombre Completo</label>
          <input type="text" id="registerName" class="form-input" placeholder="Juan P√©rez" required>
        </div>
        <div class="form-group">
          <label class="form-label">Correo Electr√≥nico</label>
          <input type="email" id="registerEmail" class="form-input" placeholder="tu@email.com" required>
        </div>
        <div class="form-group">
          <label class="form-label">Contrase√±a</label>
          <input type="password" id="registerPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required oninput="checkPasswordStrength()">
          <div id="passwordStrength" class="password-strength"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Confirmar Contrase√±a</label>
          <input type="password" id="registerConfirmPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>
        <button type="submit" class="btn-auth">Registrarse</button>
      </form>

      <div class="auth-switch">
        <span id="switchText">¬øNo tienes cuenta?</span>
        <a class="auth-link" id="switchLink">Reg√≠strate aqu√≠</a>
      </div>
    </div>
  </div>

  <!-- DASHBOARD SECTION -->
  <div id="dashboardSection" class="container hidden">
    <!-- Header -->
    <div class="header-card">
      <div class="header-content">
        <h1 class="title">Control de Pagos</h1>
        <p class="subtitle">Gestiona y organiza tus pagos de forma eficiente</p>
      </div>
      <div class="user-info">
        <div>
          <div class="user-details">
            <div class="user-name" id="userName"></div>
            <button class="btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
          </div>
        </div>
        <div class="user-avatar" id="userAvatar"></div>
      </div>
    </div>

    <!-- Estad√≠sticas -->
    <div class="stats-grid">
      <div class="stat-card stat-blue">
        <div class="stat-content">
          <div>
            <p class="stat-label">Total Pagos</p>
            <p class="stat-value" id="statCantidad">0</p>
          </div>
          <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </div>
      </div>

      <div class="stat-card stat-purple">
        <div class="stat-content">
          <div>
            <p class="stat-label">Total General</p>
            <p class="stat-value" id="statTotal">$0.00</p>
          </div>
          <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
      </div>

      <div class="stat-card stat-green">
        <div class="stat-content">
          <div>
            <p class="stat-label">Pagados</p>
            <p class="stat-value" id="statPagados">$0.00</p>
          </div>
          <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
          </svg>
        </div>
      </div>

      <div class="stat-card stat-yellow">
        <div class="stat-content">
          <div>
            <p class="stat-label">Pendientes</p>
            <p class="stat-value" id="statPendientes">$0.00</p>
          </div>
          <svg class="stat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
      </div>
    </div>

    <!-- Filtros y b√∫squeda -->
    <div class="filters-card">
      <div class="filters-content">
        <div class="search-box">
          <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <input type="text" id="searchInput" class="search-input" placeholder="Buscar por nombre o descripci√≥n...">
        </div>
        
        <div class="filter-box">
          <svg class="filter-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
          </svg>
          <select id="categoryFilter" class="filter-select">
            <option value="all">Todas las categor√≠as</option>
            <option value="servicios">Servicios</option>
            <option value="alimentaci√≥n">Alimentaci√≥n</option>
            <option value="transporte">Transporte</option>
            <option value="entretenimiento">Entretenimiento</option>
            <option value="salud">Salud</option>
            <option value="otros">Otros</option>
          </select>
        </div>

        <button class="btn-primary" onclick="openModal()">
          <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Nuevo Pago
        </button>
      </div>
    </div>

    <!-- Tabla de pagos -->
    <div class="table-card">
      <div class="table-container">
        <table class="payments-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Monto</th>
              <th>Fecha</th>
              <th>Categor√≠a</th>
              <th>Estado</th>
              <th>Descripci√≥n</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="paymentsTableBody">
            <tr>
              <td colspan="7" class="empty-row">No hay pagos registrados</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal -->
    <div id="paymentModal" class="modal-overlay hidden" onclick="closeModalOnOverlay(event)">
      <div class="modal-content" onclick="event.stopPropagation()">
        <h2 class="modal-title" id="modalTitle">Nuevo Pago</h2>
        
        <form id="paymentForm">
          <div class="form-group">
            <label class="form-label">Nombre *</label>
            <input type="text" id="paymentName" class="form-input" placeholder="Ej: Pago de luz" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Monto *</label>
              <input type="number" id="paymentAmount" step="0.01" class="form-input" placeholder="0.00" required>
            </div>

            <div class="form-group">
              <label class="form-label">Fecha *</label>
              <input type="date" id="paymentDate" class="form-input" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Categor√≠a</label>
              <select id="paymentCategory" class="form-input">
                <option value="servicios">Servicios</option>
                <option value="alimentaci√≥n">Alimentaci√≥n</option>
                <option value="transporte">Transporte</option>
                <option value="entretenimiento">Entretenimiento</option>
                <option value="salud">Salud</option>
                <option value="otros">Otros</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Estado</label>
              <select id="paymentStatus" class="form-input">
                <option value="pendiente">Pendiente</option>
                <option value="pagado">Pagado</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Descripci√≥n</label>
            <textarea id="paymentDescription" rows="3" class="form-input" placeholder="A√±ade detalles adicionales..."></textarea>
          </div>

          <div class="modal-actions">
            <button type="submit" class="btn-submit" id="submitBtn">Guardar</button>
            <button type="button" class="btn-cancel" onclick="closeModal()">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Data Storage (in memory - will reset on page reload)
    let users = [
      { id: 1, name: 'Usuario Demo', email: 'demo@email.com', password: 'demo123' }
    ];
    let currentUser = null;
    let userPayments = {
      1: [
        {
          id: 1,
          nombre: 'Servicio de Luz',
          monto: 85.50,
          fecha: '2024-11-15',
          categoria: 'servicios',
          estado: 'pagado',
          descripcion: 'Pago mensual de electricidad'
        },
        {
          id: 2,
          nombre: 'Internet Fibra √ìptica',
          monto: 45.00,
          fecha: '2024-11-20',
          categoria: 'servicios',
          estado: 'pagado',
          descripcion: 'Plan de 100 Mbps'
        },
        {
          id: 3,
          nombre: 'Supermercado',
          monto: 150.75,
          fecha: '2024-11-25',
          categoria: 'alimentaci√≥n',
          estado: 'pendiente',
          descripcion: 'Compras mensuales'
        },
        {
          id: 4,
          nombre: 'Gasolina',
          monto: 60.00,
          fecha: '2024-11-27',
          categoria: 'transporte',
          estado: 'pendiente',
          descripcion: 'Tanque completo'
        }
      ]
    }; // { userId: [payments] }
    let editingPaymentId = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      checkSession();
      setupAuthListeners();
      setupPaymentListeners();
    });

    // AUTH FUNCTIONS
    function setupAuthListeners() {
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');
      const switchLink = document.getElementById('switchLink');

      loginForm.addEventListener('submit', handleLogin);
      registerForm.addEventListener('submit', handleRegister);
      switchLink.addEventListener('click', toggleAuthForm);
    }

    function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;

      // Validaciones
      if (!validateEmail(email)) {
        showError('Por favor ingresa un correo electr√≥nico v√°lido');
        return;
      }

      if (password.length < 4) {
        showError('La contrase√±a debe tener al menos 4 caracteres');
        return;
      }

      const user = users.find(u => u.email === email && u.password === password);
      
      if (user) {
        currentUser = user;
        showSuccess('¬°Inicio de sesi√≥n exitoso!');
        setTimeout(() => {
          showDashboard();
          hideMessages();
        }, 1000);
      } else {
        showError('Credenciales incorrectas. Intenta con: demo@email.com / demo123');
      }
    }

    function handleRegister(e) {
      e.preventDefault();
      const name = document.getElementById('registerName').value.trim();
      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('registerConfirmPassword').value;

      // Validaciones
      if (name.length < 3) {
        showError('El nombre debe tener al menos 3 caracteres');
        return;
      }

      if (!validateEmail(email)) {
        showError('Por favor ingresa un correo electr√≥nico v√°lido');
        return;
      }

      if (password.length < 6) {
        showError('La contrase√±a debe tener al menos 6 caracteres');
        return;
      }

      if (password !== confirmPassword) {
        showError('Las contrase√±as no coinciden');
        return;
      }

      if (users.find(u => u.email === email)) {
        showError('Este correo ya est√° registrado. Intenta iniciar sesi√≥n.');
        return;
      }

      const newUser = {
        id: users.length + 1,
        name: name,
        email: email,
        password: password
      };

      users.push(newUser);
      userPayments[newUser.id] = [];
      
      showSuccess('¬°Cuenta creada exitosamente! Redirigiendo...');
      
      setTimeout(() => {
        currentUser = newUser;
        showDashboard();
        hideMessages();
      }, 1500);
    }

    function toggleAuthForm() {
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');
      const authTitle = document.getElementById('authTitle');
      const switchText = document.getElementById('switchText');
      const switchLink = document.getElementById('switchLink');

      if (loginForm.classList.contains('hidden')) {
        loginForm.classList.remove('hidden');
        registerForm.classList.add('hidden');
        authTitle.textContent = 'Iniciar Sesi√≥n';
        switchText.textContent = '¬øNo tienes cuenta?';
        switchLink.textContent = 'Reg√≠strate aqu√≠';
      } else {
        loginForm.classList.add('hidden');
        registerForm.classList.remove('hidden');
        authTitle.textContent = 'Crear Cuenta';
        switchText.textContent = '¬øYa tienes cuenta?';
        switchLink.textContent = 'Inicia sesi√≥n aqu√≠';
      }
      hideMessages();
    }

    function showError(message) {
      const errorMessage = document.getElementById('errorMessage');
      const successMessage = document.getElementById('successMessage');
      successMessage.classList.remove('show');
      errorMessage.textContent = message;
      errorMessage.classList.add('show');
      
      setTimeout(() => {
        errorMessage.classList.remove('show');
      }, 5000);
    }

    function showSuccess(message) {
      const errorMessage = document.getElementById('errorMessage');
      const successMessage = document.getElementById('successMessage');
      errorMessage.classList.remove('show');
      successMessage.textContent = message;
      successMessage.classList.add('show');
      
      setTimeout(() => {
        successMessage.classList.remove('show');
      }, 5000);
    }

    function hideMessages() {
      document.getElementById('errorMessage').classList.remove('show');
      document.getElementById('successMessage').classList.remove('show');
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function showForgotPassword() {
      const email = prompt('Ingresa tu correo electr√≥nico registrado:');
      if (!email) return;
      
      if (!validateEmail(email)) {
        showError('Por favor ingresa un correo electr√≥nico v√°lido');
        return;
      }
      
      const user = users.find(u => u.email === email);
      if (user) {
        showSuccess(`Se ha enviado un enlace de recuperaci√≥n a ${email}\n(Demo: tu contrase√±a es "${user.password}")`);
      } else {
        showError('No existe una cuenta asociada a este correo electr√≥nico');
      }
    }

    function checkPasswordStrength() {
      const password = document.getElementById('registerPassword').value;
      const strengthIndicator = document.getElementById('passwordStrength');
      
      if (password.length === 0) {
        strengthIndicator.textContent = '';
        return;
      }
      
      let strength = 0;
      if (password.length >= 6) strength++;
      if (password.length >= 8) strength++;
      if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
      if (/\d/.test(password)) strength++;
      if (/[^a-zA-Z\d]/.test(password)) strength++;
      
      if (strength < 2) {
        strengthIndicator.textContent = 'üî¥ Contrase√±a d√©bil';
        strengthIndicator.className = 'password-strength weak';
      } else if (strength < 4) {
        strengthIndicator.textContent = 'üü° Contrase√±a media';
        strengthIndicator.className = 'password-strength medium';
      } else {
        strengthIndicator.textContent = 'üü¢ Contrase√±a fuerte';
        strengthIndicator.className = 'password-strength strong';
      }
    }

    function checkSession() {
      // In a real app, you would check localStorage or cookies here
      // For this demo, we start at login screen
    }

    function showDashboard() {
      document.getElementById('authSection').classList.add('hidden');
      document.getElementById('dashboardSection').classList.remove('hidden');
      
      // Set user info
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
      
      // Initialize user payments if not exists
      if (!userPayments[currentUser.id]) {
        userPayments[currentUser.id] = [];
      }
      
      renderPayments();
      updateStats();
    }

    function logout() {
      currentUser = null;
      document.getElementById('authSection').classList.remove('hidden');
      document.getElementById('dashboardSection').classList.add('hidden');
      
      // Reset forms
      document.getElementById('loginForm').reset();
      document.getElementById('registerForm').reset();
      hideMessages();
    }

    // PAYMENT FUNCTIONS
    function setupPaymentListeners() {
      const searchInput = document.getElementById('searchInput');
      const categoryFilter = document.getElementById('categoryFilter');
      const paymentForm = document.getElementById('paymentForm');

      searchInput.addEventListener('input', renderPayments);
      categoryFilter.addEventListener('change', renderPayments);
      paymentForm.addEventListener('submit', handlePaymentSubmit);
    }

    function getCurrentUserPayments() {
      return userPayments[currentUser.id] || [];
    }

    function getFilteredPayments() {
      let payments = getCurrentUserPayments();
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const category = document.getElementById('categoryFilter').value;

      if (searchTerm) {
        payments = payments.filter(p => 
          p.nombre.toLowerCase().includes(searchTerm) ||
          p.descripcion.toLowerCase().includes(searchTerm)
        );
      }

      if (category !== 'all') {
        payments = payments.filter(p => p.categoria === category);
      }

      return payments;
    }

    function renderPayments() {
      const tbody = document.getElementById('paymentsTableBody');
      const payments = getFilteredPayments();

      if (payments.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty-row">No hay pagos registrados</td></tr>';
        return;
      }

      tbody.innerHTML = payments.map(payment => `
        <tr class="table-row">
          <td class="td-name">${payment.nombre}</td>
          <td class="td-amount">$${payment.monto.toFixed(2)}</td>
          <td class="td-date">${payment.fecha}</td>
          <td><span class="badge badge-category">${payment.categoria}</span></td>
          <td><span class="badge badge-${payment.estado}">${payment.estado}</span></td>
          <td class="td-description">${payment.descripcion}</td>
          <td>
            <div class="actions">
              <button class="btn-edit" onclick="editPayment(${payment.id})" title="Editar">
                <svg class="action-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
              </button>
              <button class="btn-delete" onclick="deletePayment(${payment.id})" title="Eliminar">
                <svg class="action-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      `).join('');

      updateStats();
    }

    function updateStats() {
      const payments = getCurrentUserPayments();
      const total = payments.reduce((sum, p) => sum + p.monto, 0);
      const pagados = payments.filter(p => p.estado === 'pagado').reduce((sum, p) => sum + p.monto, 0);
      const pendientes = payments.filter(p => p.estado === 'pendiente').reduce((sum, p) => sum + p.monto, 0);

      document.getElementById('statCantidad').textContent = payments.length;
      document.getElementById('statTotal').textContent = '$' + total.toFixed(2);
      document.getElementById('statPagados').textContent = '$' + pagados.toFixed(2);
      document.getElementById('statPendientes').textContent = '$' + pendientes.toFixed(2);
    }

    function openModal() {
      document.getElementById('paymentModal').classList.remove('hidden');
      document.getElementById('modalTitle').textContent = 'Nuevo Pago';
      document.getElementById('submitBtn').textContent = 'Guardar';
      document.getElementById('paymentForm').reset();
      document.getElementById('paymentDate').valueAsDate = new Date();
      editingPaymentId = null;
    }

    function closeModal() {
      document.getElementById('paymentModal').classList.add('hidden');
      document.getElementById('paymentForm').reset();
      editingPaymentId = null;
    }

    function closeModalOnOverlay(event) {
      if (event.target.id === 'paymentModal') {
        closeModal();
      }
    }

    function handlePaymentSubmit(e) {
      e.preventDefault();

      const payment = {
        id: editingPaymentId || Date.now(),
        nombre: document.getElementById('paymentName').value,
        monto: parseFloat(document.getElementById('paymentAmount').value),
        fecha: document.getElementById('paymentDate').value,
        categoria: document.getElementById('paymentCategory').value,
        estado: document.getElementById('paymentStatus').value,
        descripcion: document.getElementById('paymentDescription').value
      };

      if (editingPaymentId) {
        const index = userPayments[currentUser.id].findIndex(p => p.id === editingPaymentId);
        userPayments[currentUser.id][index] = payment;
      } else {
        userPayments[currentUser.id].push(payment);
      }

      closeModal();
      renderPayments();
    }

    function editPayment(id) {
      const payment = getCurrentUserPayments().find(p => p.id === id);
      if (!payment) return;

      document.getElementById('paymentName').value = payment.nombre;
      document.getElementById('paymentAmount').value = payment.monto;
      document.getElementById('paymentDate').value = payment.fecha;
      document.getElementById('paymentCategory').value = payment.categoria;
      document.getElementById('paymentStatus').value = payment.estado;
      document.getElementById('paymentDescription').value = payment.descripcion;

      document.getElementById('modalTitle').textContent = 'Editar Pago';
      document.getElementById('submitBtn').textContent = 'Actualizar';
      document.getElementById('paymentModal').classList.remove('hidden');
      editingPaymentId = id;
    }

    function deletePayment(id) {
      if (confirm('¬øEst√°s seguro de que deseas eliminar este pago?')) {
        userPayments[currentUser.id] = userPayments[currentUser.id].filter(p => p.id !== id);
        renderPayments();
      }
    }
  </script>

  <!-- Firebase SDK -->
<script type="module">
  // Importar Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, 
    signOut 
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  // ========== CONFIGURACI√ìN FIREBASE ==========
  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    projectId: "TU_PROJECT_ID",
    storageBucket: "TU_STORAGE_BUCKET",
    messagingSenderId: "TU_SENDER",
    appId: "TU_APP_ID"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // =============================
  //  INICIAR SESI√ìN
  // =============================
  document.getElementById("loginForm").addEventListener("submit", function(e){
    e.preventDefault();

    const email = document.getElementById("loginEmail").value;
    const pass  = document.getElementById("loginPassword").value;

    signInWithEmailAndPassword(auth, email, pass)
    .then(userCredential => {
      const user = userCredential.user;

      document.getElementById("errorMessage").classList.remove("show");
      document.getElementById("successMessage").innerText = "Inicio de sesi√≥n correcto";
      document.getElementById("successMessage").classList.add("show");

      // Mostrar Dashboard
      document.getElementById("authSection").classList.add("hidden");
      document.getElementById("dashboardSection").classList.remove("hidden");

      document.getElementById("userName").innerText = user.email;
      document.getElementById("userAvatar").innerText = user.email[0].toUpperCase();
    })
    .catch(error => {
      document.getElementById("successMessage").classList.remove("show");
      document.getElementById("errorMessage").innerText = "Credenciales incorrectas";
      document.getElementById("errorMessage").classList.add("show");
    });
  });

  // =============================
  //  REGISTRAR USUARIO
  // =============================
  document.getElementById("registerForm").addEventListener("submit", function(e){
    e.preventDefault();

    const email = document.getElementById("registerEmail").value;
    const pass  = document.getElementById("registerPassword").value;
    const pass2 = document.getElementById("registerConfirmPassword").value;

    if(pass !== pass2){
      document.getElementById("errorMessage").innerText = "Las contrase√±as no coinciden";
      document.getElementById("errorMessage").classList.add("show");
      return;
    }

    createUserWithEmailAndPassword(auth, email, pass)
    .then(userCredential => {
      document.getElementById("errorMessage").classList.remove("show");
      document.getElementById("successMessage").innerText = "Usuario registrado correctamente";
      document.getElementById("successMessage").classList.add("show");

      // Cambiar a login
      showLogin();
    })
    .catch(error => {
      document.getElementById("errorMessage").innerText = error.message;
      document.getElementById("errorMessage").classList.add("show");
    });
  });

  // =============================
  //  CERRAR SESI√ìN
  // =============================
  window.logout = function() {
    signOut(auth).then(() => {
      document.getElementById("dashboardSection").classList.add("hidden");
      document.getElementById("authSection").classList.remove("hidden");
    });
  }
</script>
</body>
</html>