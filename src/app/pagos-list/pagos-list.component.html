<div class="dashboard">
  <nav class="navbar">
    <div class="navbar-brand">
      <h2>Control de Pagos</h2>
    </div>
    <div class="navbar-user">
      <span>{{ userEmail }}</span>
      <button class="btn-logout" (click)="logout()">Cerrar Sesi√≥n</button>
    </div>
  </nav>

  <div class="sidebar">
    <ul class="menu">
      <li><a routerLink="/dashboard" routerLinkActive="active">üìä Dashboard</a></li>
      <li><a routerLink="/pagos" routerLinkActive="active">üí∞ Pagos</a></li>
      <li><a routerLink="/categorias" routerLinkActive="active">üè∑Ô∏è Categor√≠as</a></li>
      <li><a routerLink="/estadisticas" routerLinkActive="active">üìà Estad√≠sticas</a></li>
    </ul>
  </div>

  <main class="main-content">
    <div class="page-header">
      <h1>Lista de Pagos</h1>
      <a routerLink="/pagos/nuevo" class="btn-new">+ Nuevo Pago</a>
    </div>

    <div class="filters-section">
      <div class="search-box">
        <input 
          type="text" 
          placeholder="Buscar por concepto o descripci√≥n..."
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          class="search-input"
        >
      </div>

      <div class="filters">
        <select [(ngModel)]="filterCategoria" (change)="onFilterChange()" class="filter-select">
          <option value="todas">Todas las categor√≠as</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
        </select>

        <select [(ngModel)]="filterEstado" (change)="onFilterChange()" class="filter-select">
          <option value="todos">Todos los estados</option>
          <option value="pendiente">Pendiente</option>
          <option value="pagado">Pagado</option>
          <option value="vencido">Vencido</option>
        </select>

        <select [(ngModel)]="sortBy" (change)="onFilterChange()" class="filter-select">
          <option value="fecha-desc">Fecha (m√°s reciente)</option>
          <option value="fecha-asc">Fecha (m√°s antigua)</option>
          <option value="monto-desc">Monto (mayor a menor)</option>
          <option value="monto-asc">Monto (menor a mayor)</option>
        </select>
      </div>
    </div>

    <div *ngIf="loading" class="loading">Cargando pagos...</div>

    <div *ngIf="!loading" class="pagos-container">
      <div class="results-info">
        <p>Mostrando {{ pagosFiltrados.length }} de {{ pagos.length }} pagos</p>
      </div>

      <div class="pagos-grid" *ngIf="pagosFiltrados.length > 0">
        <div class="pago-card" *ngFor="let pago of pagosFiltrados">
          <div class="pago-header">
            <h3>{{ pago.concepto }}</h3>
            <span class="pago-estado" [ngClass]="pago.estado">{{ pago.estado }}</span>
          </div>
          
          <div class="pago-body">
            <div class="pago-row">
              <span class="label">Categor√≠a:</span>
              <span class="pago-categoria">{{ pago.categoria }}</span>
            </div>
            <div class="pago-row">
              <span class="label">Monto:</span>
              <span class="pago-monto">{{ pago.monto | currencySol }}</span>
            </div>
            <div class="pago-row">
              <span class="label">Fecha:</span>
              <span>{{ pago.fecha.toDate ? pago.fecha.toDate() : pago.fecha | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="pago-row" *ngIf="pago.descripcion">
              <span class="label">Descripci√≥n:</span>
              <span class="pago-descripcion">{{ pago.descripcion }}</span>
            </div>
          </div>

          <div class="pago-actions">
            <button class="btn-view" (click)="viewDetail(pago.id!)">Ver</button>
            <button class="btn-edit" (click)="editPago(pago.id!)">Editar</button>
            <button class="btn-delete" (click)="deletePago(pago.id!)">Eliminar</button>
          </div>
        </div>
      </div>

      <div *ngIf="pagosFiltrados.length === 0" class="no-results">
        <p>No se encontraron pagos con los filtros seleccionados.</p>
        <a routerLink="/pagos/nuevo" class="btn-new">Crear nuevo pago</a>
      </div>
    </div>
  </main>
</div>