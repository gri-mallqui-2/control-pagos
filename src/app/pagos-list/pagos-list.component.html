<div class="dashboard">
  <nav class="navbar">
    <div class="navbar-brand">
      <h2>Control de Pagos</h2>
    </div>
    <div class="navbar-user">
      <span>{{ userEmail }}</span>
      <button class="btn-logout" (click)="logout()">Cerrar SesiÃ³n</button>
    </div>
  </nav>

  <div class="sidebar">
    <ul class="menu">
      <li><a routerLink="/dashboard" routerLinkActive="active">ğŸ“Š Dashboard</a></li>
      <li><a routerLink="/pagos" routerLinkActive="active">ğŸ’° Pagos</a></li>
      <li><a routerLink="/categorias" routerLinkActive="active">ğŸ·ï¸ CategorÃ­as</a></li>
      <li><a routerLink="/estadisticas" routerLinkActive="active">ğŸ“ˆ EstadÃ­sticas</a></li>
    </ul>
  </div>

  <main class="main-content">
    <div class="page-header">
      <h1>Lista de Pagos</h1>
      <a routerLink="/pagos/nuevo" class="btn-new">+ Nuevo Pago</a>
    </div>

    <!-- Indicador de filtro activo -->
    <div class="filter-badge-container" *ngIf="categoriaFromRoute">
      <div class="filter-badge">
        <span class="filter-icon">ğŸ·ï¸</span>
        <span class="filter-text">Filtrando por categorÃ­a: <strong>{{ categoriaFromRoute }}</strong></span>
        <button class="filter-clear-btn" (click)="clearCategoryFilter()" title="Limpiar filtro">
          âœ•
        </button>
      </div>
    </div>

    <div class="filters-section">
      <div class="search-box">
        <input type="text" placeholder="Buscar por concepto o descripciÃ³n..." [(ngModel)]="searchTerm"
          (input)="onSearchChange()" class="search-input">
      </div>

      <div class="filters">
        <select [(ngModel)]="filterCategoria" (change)="onFilterChange()" class="filter-select">
          <option value="todas">Todas las categorÃ­as</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
        </select>

        <select [(ngModel)]="filterEstado" (change)="onFilterChange()" class="filter-select">
          <option value="todos">Todos los estados</option>
          <option value="pendiente">Pendiente</option>
          <option value="pagado">Pagado</option>
          <option value="vencido">Vencido</option>
        </select>

        <select [(ngModel)]="sortBy" (change)="onFilterChange()" class="filter-select">
          <option value="fecha-desc">Fecha (mÃ¡s reciente)</option>
          <option value="fecha-asc">Fecha (mÃ¡s antigua)</option>
          <option value="monto-desc">Monto (mayor a menor)</option>
          <option value="monto-asc">Monto (menor a mayor)</option>
        </select>
      </div>
    </div>

    <div *ngIf="loading" class="loading">Cargando pagos...</div>

    <div *ngIf="!loading" class="pagos-container">
      <div class="results-info">
        <p>Mostrando {{ pagosFiltrados.length }} de {{ pagos.length }} pagos</p>
      </div>

      <div class="pagos-grid" *ngIf="pagosFiltrados.length > 0">
        <div class="pago-card" *ngFor="let pago of pagosFiltrados">
          <div class="pago-header">
            <h3>{{ pago.concepto }}</h3>
            <span class="pago-estado" [ngClass]="pago.estado">{{ pago.estado }}</span>
          </div>

          <div class="pago-body">
            <div class="pago-row">
              <span class="label">CategorÃ­a:</span>
              <span class="pago-categoria">{{ pago.categoria }}</span>
            </div>
            <div class="pago-row">
              <span class="label">Monto:</span>
              <span class="pago-monto">{{ pago.monto | currencySol }}</span>
            </div>
            <div class="pago-row">
              <span class="label">Fecha:</span>
              <span>{{ pago.fecha.toDate ? pago.fecha.toDate() : pago.fecha | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="pago-row" *ngIf="pago.metodoPago">
              <span class="label">MÃ©todo:</span>
              <span class="pago-metodo">
                <span *ngIf="pago.metodoPago === 'yape'">ğŸ“± Yape</span>
                <span *ngIf="pago.metodoPago === 'tarjeta'">ğŸ’³ Tarjeta</span>
                <span *ngIf="pago.metodoPago === 'efectivo'">ğŸ’µ Efectivo</span>
                <span *ngIf="pago.metodoPago === 'transferencia'">ğŸ¦ Transferencia</span>
                <span *ngIf="pago.metodoPago === 'otro'">ğŸ“ Otro</span>
              </span>
            </div>
            <div class="pago-row" *ngIf="pago.descripcion">
              <span class="label">DescripciÃ³n:</span>
              <span class="pago-descripcion">{{ pago.descripcion }}</span>
            </div>
          </div>

          <div class="pago-actions">
            <button class="btn-view" (click)="viewDetail(pago.id!)">Ver</button>
            <button class="btn-edit" (click)="editPago(pago.id!)">Editar</button>
            <button class="btn-delete" (click)="deletePago(pago.id!)">Eliminar</button>
          </div>
        </div>
      </div>

      <div *ngIf="pagosFiltrados.length === 0" class="no-results">
        <p>No se encontraron pagos con los filtros seleccionados.</p>
        <a routerLink="/pagos/nuevo" class="btn-new">Crear nuevo pago</a>
      </div>
    </div>
  </main>
</div>